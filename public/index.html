<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using cra-template-moaui" />
  <link rel="icon" href="./favicon.ico" />
  <link rel="stylesheet" href="./index.css" />

  <!-- PYSCRIPT Configuration -->
  <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>
  <py-config type="json" src="./py_config.json"></py-config>

  <style>
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .spinner-container {
      margin-bottom: 30px;
      transform: translateZ(0);
      /* GPU 레이어 격리 */
    }

    .css-loader {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      will-change: transform;
    }
  </style>

  <script>
    fetch("./manifest.json")
      .then((response) => response.json())
      .then((data) => {
        document.title = data.name;
        document.bgColor = data.background_color;
      })
      .catch((error) =>
        console.error("Error fetching manifest.json:", error)
      );
  </script>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="midas-controller"></div>

  <div id="loading-screen"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #ffffff; z-index: 9999; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; transition: opacity 0.5s ease-out;">
    <div class="spinner-container">
      <div class="css-loader"></div>
    </div>
    <div style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 10px;">BESTOBEAM Designer</div>
    <div id="loading-status" style="font-size: 14px; color: #666; margin-bottom: 20px;">Initializing Application...
    </div>
    <div style="width: 250px; height: 6px; background-color: #f0f0f0; border-radius: 3px; overflow: hidden;">
      <div id="loading-bar"
        style="width: 20%; height: 100%; background-image: linear-gradient(90deg, #3498db, #2ecc71); transition: width 0.3s ease-in-out;">
      </div>
    </div>
    <div style="font-size: 11px; margin-top: 15px; color: #bbb;">© 2026 MIDAS IT Co., Ltd.</div>
  </div>

  <div id="root"></div>

  <script>
    function updateLoadingStatus(message, progress) {
      const statusElement = document.getElementById('loading-status');
      const barElement = document.getElementById('loading-bar');
      if (statusElement) statusElement.innerText = message;
      if (barElement && progress !== undefined) {
        barElement.style.width = progress + '%';
      }
      console.log(`[Loading] ${progress}%: ${message}`);
    }

    function hideLoadingScreen() {
      const screen = document.getElementById('loading-screen');
      if (screen) {
        screen.style.opacity = '0';
        setTimeout(() => {
          screen.style.display = 'none';
        }, 500);
      }
    }

    window.addEventListener('load', () => {
      updateLoadingStatus("Engine loaded, starting Python...", 40);
    });
  </script>

  <py-script terminal="false">
    from py_main import *
    from py_base import set_g_values, get_g_values
    import js

    js.updateLoadingStatus("Initializing Python environment...", 50)

    try:
        main()
    except Exception as e:
        js.console.error(f'Python initialization error: {str(e)}')
        js.updateLoadingStatus(f'Error: {str(e)}', 100)
  </py-script>
</body>

</html>
